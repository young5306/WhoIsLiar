# ğŸ”§ í”„ë¡œì íŠ¸ í¬íŒ… ë§¤ë‰´ì–¼

## 1. GitLab ì†ŒìŠ¤ í´ë¡  ì´í›„ ë¹Œë“œ ë° ë°°í¬ë¥¼ ìœ„í•œ ì •ë³´ ì •ë¦¬

---

### 1-1. ì‚¬ìš© ê¸°ìˆ  ë° ë²„ì „ ì •ë³´

#### ğŸ”§ Java ë° ë¹Œë“œ ë„êµ¬
- **JDK**: Java 17 
- **ë¹Œë“œ ë„êµ¬**: Gradle Wrapper 
- **IDE**: IntelliJ IDEA 2024

```groovy
java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(17)
    }
}
```

####  ì£¼ìš” Spring Boot ì˜ì¡´ì„±
- `spring-boot-starter-web`: REST API
- `spring-boot-starter-security`: ì¸ì¦/ì¸ê°€
- `spring-boot-starter-data-jpa`: JPA ê¸°ë°˜ ORM
- `spring-boot-starter-data-redis`: Redis ì—°ë™
- `spring-boot-starter-websocket`: ì‹¤ì‹œê°„ í†µì‹ 
- `openvidu-java-client:2.31.0`: í™”ìƒ í†µì‹ 
- `springdoc-openapi`: API ë¬¸ì„œ ìë™í™”
- `micrometer-prometheus`: ëª¨ë‹ˆí„°ë§ìš©


#### í”„ë¡ íŠ¸ì—”ë“œ ì˜ì¡´ì„± ë° ë¹Œë“œ ì •ë³´

#### í”„ë ˆì„ì›Œí¬ ë° ë„êµ¬
- **React**: 18.3.1
- **Vite**: ^6.0.5
- **TypeScript**: ~5.6.2
- **TailwindCSS**: ^4.1.4
- **MUI(Material UI)**: ^6.4.8
- **OpenVidu Browser**: ^2.31.0

#### ì£¼ìš” ì˜ì¡´ì„±
- `@mui/material`, `@mui/icons-material`: UI êµ¬ì„±
- `@emotion/react`, `@emotion/styled`: ìŠ¤íƒ€ì¼ë§
- `zustand`: ìƒíƒœ ê´€ë¦¬
- `@tanstack/react-query`: ë¹„ë™ê¸° ìºì‹±
- `sockjs-client`, `@stomp/stompjs`: WebSocket ê¸°ë°˜ í†µì‹ 
- `axios`: HTTP ìš”ì²­
- `face-api.js`, `@mediapipe/face_mesh`: ì–¼êµ´ ì¸ì‹
- `sweetalert2`, `react-toastify`: ì•Œë¦¼ ì²˜ë¦¬
- `framer-motion`: ì• ë‹ˆë©”ì´ì…˜
- `canvas-confetti`, `react-countup`: ì‹œê° íš¨ê³¼




---

### 1-2. í™˜ê²½ ë³€ìˆ˜ ë° ì„¤ì • íŒŒì¼

#### `.env` 
```env
MYSQL_URL=jdbc:mysql://mysql:3306/liar_game_db?serverTimezone=Asia/Seoul&useSSL=false&allowPublicKeyRetrieval=true
MYSQL_USERNAME=a604
MYSQL_PASSWORD=skdaks

MYSQL_ROOT_PASSWORD=skdaks
MYSQL_DATABASE=liar_game_db
MYSQL_USER=a604
MYSQL_PASSWORD=skdaks

OPENVIDU_URL=https://whoisliar.me:4443
OPENVIDU_SECRET=MY_SECRET

REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=skdaks

VITE_APP_API_URL=https://whoisliar.me/api
VITE_APP_WEBSOCKET_URL=https://whoisliar.me/ws

OPENAI_API_KEY=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

```



---

### 1-3. ë°°í¬ ì‹œ íŠ¹ì´ì‚¬í•­

####  ë¬´ì¤‘ë‹¨ ë°°í¬ ë°©ì‹ (Blue-Green Deployment)

- `backend-blue`, `backend-green` ë‘ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë²ˆê°ˆì•„ê°€ë©° ì‚¬ìš©
- í”„ë¡ íŠ¸ì—”ë“œë„ `frontend-blue`, `frontend-green` êµ¬ì„±
- Nginxê°€ í˜„ì¬ live ìƒíƒœë¥¼ ê¸°ì¤€ìœ¼ë¡œ proxy ì—°ê²°
- ë°°í¬ ëŒ€ìƒ ë³€ê²½ ì‹œ `nginx -s reload`

####  ë¬´ì¤‘ë‹¨ ë°°í¬ ìˆœì„œ ì˜ˆì‹œ

1. GitLab â†’ Jenkinsë¡œ Webhook Trigger
2. Jenkins Pipelineì´ ë‹¤ìŒ ë‹¨ê³„ ìˆœì„œë¡œ ì‹¤í–‰:
   - ì†ŒìŠ¤ Checkout
   - Backend/Frontend ê°ê° Build
   - ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (ì˜ˆ: `backend-green`)
   - í—¬ìŠ¤ ì²´í¬ API(`/actuator/health`)ë¡œ ìƒíƒœ í™•ì¸
   - ì„±ê³µ ì‹œ Nginx ì„¤ì •ì„ ìƒˆ ì»¨í…Œì´ë„ˆë¡œ ë³€ê²½ í›„ `reload`
   - ì´ì „ ì»¨í…Œì´ë„ˆ ì¤‘ì§€ (ì˜ˆ: `backend-blue`)

```bash
docker-compose -f docker-compose.green.yml up -d --build
curl http://localhost:8080/actuator/health
docker exec nginx nginx -s reload
docker-compose -f docker-compose.blue.yml down
```

####  ì»¨í…Œì´ë„ˆ ë„¤ì´ë° ê·œì¹™
| êµ¬ì„± ìš”ì†Œ | ì˜ˆì‹œ ë„¤ì´ë°                       |
| --------- | --------------------------------- |
| Backend   | `backend-green`, `backend-blue`   |
| Frontend  | `frontend-green`, `frontend-blue` |

---

### 1-4. ë°ì´í„°ë² ì´ìŠ¤ ë° ì„¤ì • ì •ë³´

#### DB ì ‘ì† ì •ë³´ (`application.yml`)
```yaml
spring:
  datasource:
    url: ${MYSQL_URL}
    username: ${MYSQL_USERNAME}
    password: ${MYSQL_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver
```

#### ì£¼ìš” í…Œì´ë¸” (ERD ê¸°ì¤€)
- `session`: í™”ìƒ ì„¸ì…˜ ì •ë³´
- `rooms`: ê²Œì„ ë°©ë°© ì •ë³´

#### ì„¤ì • ê´€ë ¨ ì£¼ìš” íŒŒì¼
| íŒŒì¼ëª…                    | ìš©ë„                      |
| ------------------------- | ------------------------- |
| `.env`                    | í™˜ê²½ ë³€ìˆ˜ ì •ì˜            |
| `application.yml`         | Spring Boot ì„¤ì •          |
| `docker-compose.yml`      | ë²¡,í”„ë¡ íŠ¸íŠ¸ ì»¨í…Œì´ë„ˆ ì •ì˜ |
| `docker-compose.core.yml` | ì£¼ìš” ì»¨í…Œì´ë„ˆ ì •ì˜        |
| `nginx.conf`              | Proxy ë° ë¬´ì¤‘ë‹¨ ë°°í¬ ì„¤ì • |
| `prometheus.yml`          | ëª¨ë‹ˆí„°ë§ êµ¬ì„±             |

---

###  ì°¸ê³ ì‚¬í•­
- ë°°í¬ í™˜ê²½ì— ë”°ë¼ `prod`, `local` í”„ë¡œíŒŒì¼ì„ êµ¬ë¶„
- Nginx ë¼ìš°íŒ…ì„ í†µí•œ ì‹¤ì‹œê°„ ì‚¬ìš©ì ìš”ì²­ ë¬´ì¤‘ë‹¨ ì²˜ë¦¬