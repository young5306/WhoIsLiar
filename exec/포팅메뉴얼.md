# 🔧 프로젝트 포팅 매뉴얼

## 1. GitLab 소스 클론 이후 빌드 및 배포를 위한 정보 정리

---

### 1-1. 사용 기술 및 버전 정보

#### 🔧 Java 및 빌드 도구
- **JDK**: Java 17 
- **빌드 도구**: Gradle Wrapper 
- **IDE**: IntelliJ IDEA 2024

```groovy
java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(17)
    }
}
```

####  주요 Spring Boot 의존성
- `spring-boot-starter-web`: REST API
- `spring-boot-starter-security`: 인증/인가
- `spring-boot-starter-data-jpa`: JPA 기반 ORM
- `spring-boot-starter-data-redis`: Redis 연동
- `spring-boot-starter-websocket`: 실시간 통신
- `openvidu-java-client:2.31.0`: 화상 통신
- `springdoc-openapi`: API 문서 자동화
- `micrometer-prometheus`: 모니터링용


#### 프론트엔드 의존성 및 빌드 정보

#### 프레임워크 및 도구
- **React**: 18.3.1
- **Vite**: ^6.0.5
- **TypeScript**: ~5.6.2
- **TailwindCSS**: ^4.1.4
- **MUI(Material UI)**: ^6.4.8
- **OpenVidu Browser**: ^2.31.0

#### 주요 의존성
- `@mui/material`, `@mui/icons-material`: UI 구성
- `@emotion/react`, `@emotion/styled`: 스타일링
- `zustand`: 상태 관리
- `@tanstack/react-query`: 비동기 캐싱
- `sockjs-client`, `@stomp/stompjs`: WebSocket 기반 통신
- `axios`: HTTP 요청
- `face-api.js`, `@mediapipe/face_mesh`: 얼굴 인식
- `sweetalert2`, `react-toastify`: 알림 처리
- `framer-motion`: 애니메이션
- `canvas-confetti`, `react-countup`: 시각 효과




---

### 1-2. 환경 변수 및 설정 파일

#### `.env` 
```env
MYSQL_URL=jdbc:mysql://mysql:3306/liar_game_db?serverTimezone=Asia/Seoul&useSSL=false&allowPublicKeyRetrieval=true
MYSQL_USERNAME=a604
MYSQL_PASSWORD=skdaks

MYSQL_ROOT_PASSWORD=skdaks
MYSQL_DATABASE=liar_game_db
MYSQL_USER=a604
MYSQL_PASSWORD=skdaks

OPENVIDU_URL=https://whoisliar.me:4443
OPENVIDU_SECRET=MY_SECRET

REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=skdaks

VITE_APP_API_URL=https://whoisliar.me/api
VITE_APP_WEBSOCKET_URL=https://whoisliar.me/ws

OPENAI_API_KEY=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

```



---

### 1-3. 배포 시 특이사항

####  무중단 배포 방식 (Blue-Green Deployment)

- `backend-blue`, `backend-green` 두 인스턴스를 번갈아가며 사용
- 프론트엔드도 `frontend-blue`, `frontend-green` 구성
- Nginx가 현재 live 상태를 기준으로 proxy 연결
- 배포 대상 변경 시 `nginx -s reload`

####  무중단 배포 순서 예시

1. GitLab → Jenkins로 Webhook Trigger
2. Jenkins Pipeline이 다음 단계 순서로 실행:
   - 소스 Checkout
   - Backend/Frontend 각각 Build
   - 새로운 컨테이너 실행 (예: `backend-green`)
   - 헬스 체크 API(`/actuator/health`)로 상태 확인
   - 성공 시 Nginx 설정을 새 컨테이너로 변경 후 `reload`
   - 이전 컨테이너 중지 (예: `backend-blue`)

```bash
docker-compose -f docker-compose.green.yml up -d --build
curl http://localhost:8080/actuator/health
docker exec nginx nginx -s reload
docker-compose -f docker-compose.blue.yml down
```

####  컨테이너 네이밍 규칙
| 구성 요소 | 예시 네이밍                       |
| --------- | --------------------------------- |
| Backend   | `backend-green`, `backend-blue`   |
| Frontend  | `frontend-green`, `frontend-blue` |

---

### 1-4. 데이터베이스 및 설정 정보

#### DB 접속 정보 (`application.yml`)
```yaml
spring:
  datasource:
    url: ${MYSQL_URL}
    username: ${MYSQL_USERNAME}
    password: ${MYSQL_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver
```

#### 주요 테이블 (ERD 기준)
- `session`: 화상 세션 정보
- `rooms`: 게임 방방 정보

#### 설정 관련 주요 파일
| 파일명                    | 용도                      |
| ------------------------- | ------------------------- |
| `.env`                    | 환경 변수 정의            |
| `application.yml`         | Spring Boot 설정          |
| `docker-compose.yml`      | 벡,프론트트 컨테이너 정의 |
| `docker-compose.core.yml` | 주요 컨테이너 정의        |
| `nginx.conf`              | Proxy 및 무중단 배포 설정 |
| `prometheus.yml`          | 모니터링 구성             |

---

###  참고사항
- 배포 환경에 따라 `prod`, `local` 프로파일을 구분
- Nginx 라우팅을 통한 실시간 사용자 요청 무중단 처리